#!/usr/bin/env bash
set -e

# åˆ›å»ºè„šæœ¬ç›®å½•
mkdir -p scripts

# æ™ºèƒ½æ£€æµ‹Androidé¡¹ç›®ç»“æ„
detect_android_project() {
  local project_root=""
  local current_dir="$(pwd)"
  
  # å‘ä¸ŠæŸ¥æ‰¾Androidé¡¹ç›®æ ¹ç›®å½•
  while [ "$current_dir" != "/" ]; do
    if [ -f "$current_dir/build.gradle" ] || [ -f "$current_dir/build.gradle.kts" ]; then
      if [ -f "$current_dir/settings.gradle" ] || [ -f "$current_dir/settings.gradle.kts" ]; then
        project_root="$current_dir"
        break
      fi
    fi
    current_dir=$(dirname "$current_dir")
  done
  
  if [ -z "$project_root" ]; then
    # å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ¹ç›®å½•ï¼Œæ£€æŸ¥å½“å‰ç›®å½•æ˜¯å¦æ˜¯æ¨¡å—ç›®å½•
    if [ -f "build.gradle" ] || [ -f "build.gradle.kts" ]; then
      echo "module"
      return
    else
      echo "not_android"
      return
    fi
  fi
  
  echo "$project_root"
}

# æ£€æµ‹é¡¹ç›®ç±»å‹å’Œç»“æ„
PROJECT_LOCATION=$(detect_android_project)

if [ "$PROJECT_LOCATION" = "not_android" ]; then
  echo "âŒ é”™è¯¯ï¼šå½“å‰ç›®å½•ä¸æ˜¯Androidé¡¹ç›®"
  echo "   è¯·åœ¨Androidé¡¹ç›®æ ¹ç›®å½•æˆ–æ¨¡å—ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬"
  exit 1
elif [ "$PROJECT_LOCATION" = "module" ]; then
  echo "ğŸ” æ£€æµ‹åˆ°å½“å‰ç›®å½•æ˜¯Androidæ¨¡å—ï¼Œå°†ä¸ºæ¨¡å—é…ç½®lint"
  PROJECT_ROOT="$(pwd)"
  IS_MODULE=true
else
  echo "ğŸ” æ£€æµ‹åˆ°Androidé¡¹ç›®æ ¹ç›®å½•: $PROJECT_LOCATION"
  PROJECT_ROOT="$PROJECT_LOCATION"
  IS_MODULE=false
fi

# æ£€æµ‹DSLç±»å‹
DSL_TYPE="unknown"
if [ -f "$PROJECT_ROOT/build.gradle.kts" ] || [ -f "build.gradle.kts" ]; then
  DSL_TYPE="kotlin"
elif [ -f "$PROJECT_ROOT/build.gradle" ] || [ -f "build.gradle" ]; then
  DSL_TYPE="groovy"
fi

# æ£€æµ‹æ¨¡å—ç±»å‹
MODULE_TYPE="unknown"
if [ -f "build.gradle" ]; then
  if grep -q "com.android.application" "build.gradle" 2>/dev/null; then
    MODULE_TYPE="app"
  elif grep -q "com.android.library" "build.gradle" 2>/dev/null; then
    MODULE_TYPE="library"
  fi
elif [ -f "build.gradle.kts" ]; then
  if grep -q "com.android.application" "build.gradle.kts" 2>/dev/null; then
    MODULE_TYPE="app"
  elif grep -q "com.android.library" "build.gradle.kts" 2>/dev/null; then
    MODULE_TYPE="library"
  fi
fi

echo "ğŸ“‹ é¡¹ç›®ä¿¡æ¯ï¼š"
echo "   DSLç±»å‹: $DSL_TYPE"
echo "   æ¨¡å—ç±»å‹: $MODULE_TYPE"
echo "   æ˜¯å¦ä¸ºæ¨¡å—: $IS_MODULE"

# å®‰å…¨ç”Ÿæˆé…ç½®æ–‡ä»¶çš„å‡½æ•°
safe_create_file() {
  local file_path="$1"
  local file_content="$2"
  
  if [ -f "$file_path" ]; then
    echo "âš ï¸  $file_path å·²å­˜åœ¨ï¼Œåˆ›å»ºå¤‡ä»½: ${file_path}.backup"
    cp "$file_path" "${file_path}.backup"
  fi
  
  echo "$file_content" > "$file_path"
  echo "âœ… å·²ç”Ÿæˆ: $file_path"
}

# ç”Ÿæˆ lint.xml é…ç½®æ–‡ä»¶
LINT_CONFIG='<?xml version="1.0" encoding="UTF-8"?>
<lint>
    <!-- é”™è¯¯çº§åˆ«è§„åˆ™ -->
    <issue id="HardcodedText" severity="error" />
    <issue id="MissingTranslation" severity="error" />
    <issue id="UnusedResources" severity="error" />
    <issue id="IconMissingDensityFolder" severity="error" />
    <issue id="SecurityLogCatch" severity="error" />
    <issue id="LogConditional" severity="error" />
    
    <!-- è­¦å‘Šçº§åˆ«è§„åˆ™ -->
    <issue id="UselessParent" severity="warning" />
    <issue id="InefficientWeight" severity="warning" />
    <issue id="NestedWeights" severity="warning" />
    <issue id="DisableBaselineAlignment" severity="warning" />
    <issue id="ObsoleteLayoutParam" severity="warning" />
    <issue id="Overdraw" severity="warning" />
    
    <!-- æ€§èƒ½ç›¸å…³ -->
    <issue id="DrawAllocation" severity="warning" />
    <issue id="Recycle" severity="error" />
    <issue id="WakelockTimeout" severity="warning" />
    
    <!-- å®‰å…¨ç›¸å…³ -->
    <issue id="AllowBackup" severity="warning" />
    <issue id="ExportedActivity" severity="warning" />
    <issue id="ExportedReceiver" severity="warning" />
    <issue id="ExportedService" severity="warning" />
    
    <!-- å¿½ç•¥çš„è§„åˆ™ -->
    <issue id="GoogleAppIndexingWarning" severity="ignore" />
    <issue id="LintBaseline" severity="ignore" />
    
    <!-- Kotlin ç›¸å…³ -->
    <issue id="UnsafeCall" severity="error" />
    <issue id="NullSafeMutableLiveData" severity="warning" />
</lint>'

safe_create_file "lint.xml" "$LINT_CONFIG"

# ç”Ÿæˆ ktlint é…ç½®æ–‡ä»¶ (.editorconfig)
EDITORCONFIG='root = true

[*]
charset = utf-8
end_of_line = lf
indent_style = space
indent_size = 4
insert_final_newline = true
max_line_length = 120
trim_trailing_whitespace = true

[*.{kt,kts}]
indent_size = 4
continuation_indent_size = 4

[*.{xml,html}]
indent_size = 4

[*.{json,yml,yaml}]
indent_size = 2

[*.md]
trim_trailing_whitespace = false'

safe_create_file ".editorconfig" "$EDITORCONFIG"

# ç”Ÿæˆ .gitignoreï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
if [ ! -f ".gitignore" ]; then
cat <<EOF > .gitignore
# Built application files
*.apk
*.aab

# Files for the ART/Dalvik VM
*.dex

# Java class files
*.class

# Generated files
bin/
gen/
out/
release/

# Gradle files
.gradle/
build/

# Local configuration file (sdk path, etc)
local.properties

# Proguard folder generated by Eclipse
proguard/

# Log Files
*.log

# Android Studio Navigation editor temp files
.navigation/

# Android Studio captures folder
captures/

# IntelliJ
*.iml
.idea/workspace.xml
.idea/tasks.xml
.idea/gradle.xml
.idea/assetWizardSettings.xml
.idea/dictionaries
.idea/libraries
.idea/jarRepositories.xml
.idea/caches
.idea/modules.xml
.idea/.name
.idea/compiler.xml
.idea/copyright/profiles_settings.xml
.idea/encodings.xml
.idea/scopes/scope_settings.xml
.idea/vcs.xml
.idea/jsLibraryMappings.xml
.idea/datasources.xml
.idea/dataSources.ids
.idea/sqlDataSources.xml
.idea/dynamic.xml
.idea/uiDesigner.xml

# OS-specific files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Android Lint
lint-results.html
lint-results_files/
lint-report.txt

# Ktlint
.ktlint

# Backup files
*.bak
EOF
fi

# ç”Ÿæˆæ™ºèƒ½çš„Gradleé…ç½®
generate_gradle_config() {
  if [ "$DSL_TYPE" = "kotlin" ]; then
    cat > "gradle-lint-config.kts" << 'EOF'
// ============================================
// Android Lint é…ç½®
// ============================================
// å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„æ¨¡å— build.gradle.kts æ–‡ä»¶çš„ android {} å—ä¸­

android {
    lint {
        // åŸºæœ¬é…ç½®
        abortOnError = false  // å»ºè®®å…ˆè®¾ä¸ºfalseï¼Œä¿®å¤é—®é¢˜åå†è®¾ä¸ºtrue
        warningsAsErrors = false
        checkDependencies = true
        checkGeneratedSources = false
        explainIssues = true
        
        // å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•
        ignoreTestSources = true
        ignoreTestFixturesSources = true
        
        // è¾“å‡ºæ ¼å¼
        htmlReport = true
        htmlOutput = file("$buildDir/reports/lint/lint-results.html")
        xmlReport = true
        xmlOutput = file("$buildDir/reports/lint/lint-results.xml")
        textReport = true
        textOutput = file("$buildDir/reports/lint/lint-results.txt")
        
        // ä½¿ç”¨é…ç½®æ–‡ä»¶
        lintConfig = file("lint.xml")
        
        // åŸºçº¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        // baseline = file("lint-baseline.xml")
    }
}

// ============================================
// Ktlint é…ç½®
// ============================================
// 1. åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ build.gradle.kts æ·»åŠ æ’ä»¶ï¼š
/*
plugins {
    id("org.jlleitschuh.gradle.ktlint") version "12.0.3" apply false
}
*/

// 2. åœ¨æ¨¡å—çš„ build.gradle.kts æ·»åŠ ï¼š
/*
plugins {
    id("org.jlleitschuh.gradle.ktlint")
}

ktlint {
    version.set("1.0.1")
    debug.set(false)
    verbose.set(true)
    android.set(true)
    outputToConsole.set(true)
    outputColorName.set("RED")
    ignoreFailures.set(false)
    
    filter {
        exclude("**/generated/**")
        exclude("**/build/**")
        include("**/kotlin/**")
        include("**/java/**")
    }
}
*/
EOF
  else
    cat > "gradle-lint-config.gradle" << 'EOF'
// ============================================
// Android Lint é…ç½®
// ============================================
// å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„æ¨¡å— build.gradle æ–‡ä»¶çš„ android {} å—ä¸­

android {
    lint {
        // åŸºæœ¬é…ç½®
        abortOnError false  // å»ºè®®å…ˆè®¾ä¸ºfalseï¼Œä¿®å¤é—®é¢˜åå†è®¾ä¸ºtrue
        warningsAsErrors false
        checkDependencies true
        checkGeneratedSources false
        explainIssues true
        
        // å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•
        ignoreTestSources true
        ignoreTestFixturesSources true
        
        // è¾“å‡ºæ ¼å¼
        htmlReport true
        htmlOutput file("$buildDir/reports/lint/lint-results.html")
        xmlReport true
        xmlOutput file("$buildDir/reports/lint/lint-results.xml")
        textReport true
        textOutput file("$buildDir/reports/lint/lint-results.txt")
        
        // ä½¿ç”¨é…ç½®æ–‡ä»¶
        lintConfig file("lint.xml")
        
        // åŸºçº¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        // baseline file("lint-baseline.xml")
    }
}

// ============================================
// Ktlint é…ç½®
// ============================================
// 1. åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ build.gradle æ·»åŠ æ’ä»¶ï¼š
/*
plugins {
    id "org.jlleitschuh.gradle.ktlint" version "12.0.3" apply false
}
*/

// 2. åœ¨æ¨¡å—çš„ build.gradle æ·»åŠ ï¼š
/*
apply plugin: "org.jlleitschuh.gradle.ktlint"

ktlint {
    version = "1.0.1"
    debug = false
    verbose = true
    android = true
    outputToConsole = true
    outputColorName = "RED"
    ignoreFailures = false
    
    filter {
        exclude("**/generated/**")
        exclude("**/build/**")
        include("**/kotlin/**")
        include("**/java/**")
    }
}
*/
EOF
  fi
  
  echo "âœ… å·²ç”Ÿæˆ: gradle-lint-config.${DSL_TYPE}"
}

generate_gradle_config

# ç”Ÿæˆæ™ºèƒ½çš„Makefile
MAKEFILE_CONTENT=".PHONY: lint ktlint format commit commit-force setup help

help:
	@echo \"ğŸ“‹ å¯ç”¨å‘½ä»¤:\"
	@echo \"  make lint         - è¿è¡Œ Android Lint æ£€æŸ¥\"
	@echo \"  make ktlint       - è¿è¡Œ Ktlint æ£€æŸ¥\"
	@echo \"  make format       - è‡ªåŠ¨æ ¼å¼åŒ– Kotlin ä»£ç \"
	@echo \"  make commit       - æ™ºèƒ½æäº¤ï¼ˆæœ‰æ£€æŸ¥ï¼‰\"
	@echo \"  make commit-force - å¼ºåˆ¶æäº¤ï¼ˆè·³è¿‡æ£€æŸ¥ï¼‰\"
	@echo \"  make setup        - æ˜¾ç¤ºé…ç½®è¯´æ˜\"

lint:
	@if [ -f \"gradlew\" ]; then \\
		echo \"ğŸ” è¿è¡Œ Android Lint...\"; \\
		./gradlew lint || echo \"âš ï¸ Lint æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æŠ¥å‘Š\"; \\
	else \\
		echo \"âŒ æœªæ‰¾åˆ° gradlewï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ\"; \\
	fi

ktlint:
	@if [ -f \"gradlew\" ]; then \\
		echo \"ğŸ” è¿è¡Œ Ktlint æ£€æŸ¥...\"; \\
		./gradlew ktlintCheck || echo \"âš ï¸ Ktlint æ£€æŸ¥å‘ç°é—®é¢˜\"; \\
	else \\
		echo \"âŒ æœªæ‰¾åˆ° gradlewï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ\"; \\
	fi

format:
	@if [ -f \"gradlew\" ]; then \\
		echo \"ğŸ”§ æ ¼å¼åŒ– Kotlin ä»£ç ...\"; \\
		./gradlew ktlintFormat || echo \"âš ï¸ é¡¹ç›®å¯èƒ½æœªé…ç½® Ktlint\"; \\
	else \\
		echo \"âŒ æœªæ‰¾åˆ° gradlewï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ\"; \\
	fi

commit:
	bash scripts/android-smart-commit.sh

commit-force:
	bash scripts/android-smart-commit.sh --force

setup:
	@echo \"ğŸ“‹ é…ç½®è¯´æ˜ï¼š\"
	@echo \"1. å°† gradle-lint-config.${DSL_TYPE} ä¸­çš„å†…å®¹æ·»åŠ åˆ°å¯¹åº”çš„ Gradle æ–‡ä»¶\"
	@echo \"2. å¦‚éœ€ä½¿ç”¨ Ktlintï¼Œå–æ¶ˆæ³¨é‡Šé…ç½®æ–‡ä»¶ä¸­çš„ Ktlint ç›¸å…³é…ç½®\"
	@echo \"3. è¿è¡Œ ./gradlew ktlintApplyToIdea æ¥é…ç½® Android Studioï¼ˆå¯é€‰ï¼‰\"
	@echo \"4. ä½¿ç”¨ 'make lint' è¿è¡Œ Android Lint æ£€æŸ¥\"
	@echo \"5. ä½¿ç”¨ 'make help' æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤\"
	@echo \"\"
	@echo \"ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ï¼š\"
	@echo \"   - lint.xml: Android Lint è§„åˆ™é…ç½®\"
	@echo \"   - .editorconfig: ä»£ç é£æ ¼é…ç½®\"
	@echo \"   - gradle-lint-config.${DSL_TYPE}: Gradle é…ç½®ç¤ºä¾‹\"
	@echo \"   - scripts/android-smart-commit.sh: æ™ºèƒ½æäº¤è„šæœ¬\"
	@echo \"\"
	@echo \"ğŸ”§ é¡¹ç›®ä¿¡æ¯ï¼š\"
	@echo \"   - DSLç±»å‹: ${DSL_TYPE}\"
	@echo \"   - æ¨¡å—ç±»å‹: ${MODULE_TYPE}\"
	@echo \"   - é¡¹ç›®æ ¹ç›®å½•: ${PROJECT_ROOT}\""

safe_create_file "Makefile" "$MAKEFILE_CONTENT"

# ç”Ÿæˆ Android æ™ºèƒ½æäº¤è„šæœ¬
cat <<'EOF' > scripts/android-smart-commit.sh
#!/usr/bin/env bash
set -e

# æ£€æŸ¥å¼ºåˆ¶æ¨¡å¼
FORCE_MODE=false
if [[ "$1" == "--force" ]]; then
  FORCE_MODE=true
fi

# æ£€æŸ¥æ˜¯å¦åœ¨Androidé¡¹ç›®æ ¹ç›®å½•
if [ ! -f "build.gradle" ] && [ ! -f "build.gradle.kts" ]; then
  echo "âŒ é”™è¯¯ï¼šè¯·åœ¨Androidé¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬"
  exit 1
fi

# è‡ªåŠ¨æ·»åŠ æ–‡ä»¶å˜æ›´
if [ -n "$(git diff --name-only)" ] || [ -n "$(git diff --cached --name-only)" ]; then
  echo "ğŸ“¦ æ£€æµ‹åˆ°æ–‡ä»¶å˜æ›´ï¼Œè‡ªåŠ¨æ‰§è¡Œ git add ."
  git add .
fi

echo ""
echo "âœ¨ Step 1: Ktlint æ ¼å¼åŒ–"
if [ -f "gradlew" ]; then
  # è¯¢é—®æ˜¯å¦éœ€è¦æ ¼å¼åŒ– - é»˜è®¤ä¸ºå¦
  read -p "ğŸ¤” æ˜¯å¦è¿è¡Œ Ktlint è‡ªåŠ¨æ ¼å¼åŒ–ï¼Ÿ(y/N): " FORMAT_CONFIRM
  FORMAT_CONFIRM=${FORMAT_CONFIRM:-n}
  
  if [[ "$FORMAT_CONFIRM" =~ ^[Yy]$ ]]; then
    echo "ğŸ”§ æ­£åœ¨è¿è¡Œ Ktlint æ ¼å¼åŒ–..."
    if ./gradlew ktlintFormat > /dev/null 2>&1; then
      echo "âœ… Ktlint æ ¼å¼åŒ–å®Œæˆ"
      if [ -n "$(git diff --name-only)" ]; then
        echo "ğŸ“¦ æ ¼å¼åŒ–åæ£€æµ‹åˆ°æ–‡ä»¶å˜æ›´ï¼Œè‡ªåŠ¨æš‚å­˜"
        git add .
      fi
    else
      echo "âš ï¸ Ktlint æ ¼å¼åŒ–å¤±è´¥ï¼Œå¯èƒ½é¡¹ç›®æœªé…ç½® Ktlint"
    fi
  else
    echo "â© è·³è¿‡ Ktlint æ ¼å¼åŒ–"
  fi
else
  echo "âš ï¸ æœªæ‰¾åˆ° gradlewï¼Œè·³è¿‡ Ktlint æ ¼å¼åŒ–"
fi

echo ""
echo "ğŸ” Step 2: è¿è¡Œ Ktlint æ£€æŸ¥..."
if [ -f "gradlew" ]; then
  if ./gradlew ktlintCheck; then
    echo "âœ… Ktlint æ£€æŸ¥é€šè¿‡"
  else
    echo "â›” Ktlint æ£€æŸ¥å¤±è´¥"
    if [ "$FORCE_MODE" = false ]; then
      read -p "ğŸ¤” æ˜¯å¦ç»§ç»­æäº¤ï¼Ÿ(Y/n): " CONTINUE_CONFIRM
      CONTINUE_CONFIRM=${CONTINUE_CONFIRM:-y}
      if [[ "$CONTINUE_CONFIRM" =~ ^[Nn]$ ]]; then
        echo "âŒ å·²å–æ¶ˆæäº¤"
        exit 1
      fi
    else
      echo "âš ï¸ å¼ºåˆ¶æ¨¡å¼ï¼šå¿½ç•¥ Ktlint é”™è¯¯ç»§ç»­æäº¤"
    fi
  fi
else
  echo "âš ï¸ æœªæ‰¾åˆ° gradlewï¼Œè·³è¿‡ Ktlint æ£€æŸ¥"
fi

echo ""
echo "ğŸ” Step 3: è¿è¡Œ Android Lint æ£€æŸ¥..."
if [ -f "gradlew" ]; then
  if ./gradlew lint; then
    echo "âœ… Android Lint æ£€æŸ¥é€šè¿‡"
  else
    echo "â›” Android Lint æ£€æŸ¥å¤±è´¥"
    echo "ğŸ“‹ æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š: build/reports/lint/lint-results.html"
    if [ "$FORCE_MODE" = false ]; then
      read -p "ğŸ¤” æ˜¯å¦ç»§ç»­æäº¤ï¼Ÿ(Y/n): " CONTINUE_CONFIRM
      CONTINUE_CONFIRM=${CONTINUE_CONFIRM:-y}
      if [[ "$CONTINUE_CONFIRM" =~ ^[Nn]$ ]]; then
        echo "âŒ å·²å–æ¶ˆæäº¤"
        exit 1
      fi
    else
      echo "âš ï¸ å¼ºåˆ¶æ¨¡å¼ï¼šå¿½ç•¥ Android Lint é”™è¯¯ç»§ç»­æäº¤"
    fi
  fi
else
  echo "âš ï¸ æœªæ‰¾åˆ° gradlewï¼Œè·³è¿‡ Android Lint æ£€æŸ¥"
fi

echo ""
echo "ğŸ¤– Step 4: ç”Ÿæˆæäº¤ä¿¡æ¯å¹¶æäº¤..."
echo "ğŸ“ æ­£åœ¨è°ƒç”¨ GPTCommit ç”Ÿæˆæäº¤ä¿¡æ¯..."
git commit --quiet --no-edit
echo ""
echo "ğŸ‰ æäº¤å®Œæˆï¼"
EOF

chmod +x scripts/android-smart-commit.sh

# åˆ›å»ºç¤ºä¾‹ Kotlin Activityï¼ˆå¦‚æœ app/src/main/java ç›®å½•å­˜åœ¨ï¼‰
if [ -d "app/src/main/java" ]; then
  # æŸ¥æ‰¾åŒ…å
  PACKAGE_DIR=$(find app/src/main/java -type d -mindepth 1 | head -1)
  if [ -n "$PACKAGE_DIR" ]; then
    PACKAGE_NAME=$(echo "$PACKAGE_DIR" | sed 's|app/src/main/java/||' | tr '/' '.')
    
    cat <<EOF > "${PACKAGE_DIR}/ExampleActivity.kt"
package ${PACKAGE_NAME}

import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity

/**
 * ç¤ºä¾‹ Activity - å±•ç¤ºä»£ç è§„èŒƒ
 */
class ExampleActivity : AppCompatActivity() {
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        // ç¤ºä¾‹ï¼šç¬¦åˆ Kotlin ä»£ç è§„èŒƒ
        val message = getString(R.string.app_name)
        setupViews(message)
    }
    
    private fun setupViews(title: String) {
        // ä»£ç å®ç°
        supportActionBar?.title = title
    }
    
    companion object {
        private const val TAG = "ExampleActivity"
    }
}
EOF
    echo "ğŸ“ å·²åˆ›å»ºç¤ºä¾‹æ–‡ä»¶: ${PACKAGE_DIR}/ExampleActivity.kt"
  fi
fi

echo ""
echo "âœ… Android Lint/Ktlint è„šæœ¬ä¸é…ç½®åˆå§‹åŒ–å®Œæˆï¼"
echo "   - lint.xml (Android Lint è§„åˆ™é…ç½®)"
echo "   - .editorconfig (Ktlint ä»£ç é£æ ¼é…ç½®)"
echo "   - .gitignore (å¦‚æœä¸å­˜åœ¨)"
echo "   - gradle-lint-config.${DSL_TYPE} (Gradle é…ç½®ç¤ºä¾‹)"
echo "   - scripts/android-smart-commit.sh (æ™ºèƒ½æäº¤è„šæœ¬)"
echo "   - Makefile (å¿«æ·å‘½ä»¤)"
if [ -d "app/src/main/java" ]; then
echo "   - ExampleActivity.kt (ç¤ºä¾‹ä»£ç æ–‡ä»¶)"
fi
echo ""
echo "ğŸ¯ ä¸‹ä¸€æ­¥é…ç½®ï¼š"
echo "   1. è¿è¡Œ 'make setup' æŸ¥çœ‹é…ç½®è¯´æ˜"
echo "   2. å°† gradle-lint-config ä¸­çš„å†…å®¹æ·»åŠ åˆ°å¯¹åº”çš„ Gradle æ–‡ä»¶"
echo "   3. è¿è¡Œ 'make lint' æ£€æŸ¥ Android Lint"
echo "   4. è¿è¡Œ 'make ktlint' æ£€æŸ¥ Kotlin ä»£ç é£æ ¼"
echo "   5. ä½¿ç”¨ 'make commit' è¿›è¡Œæ™ºèƒ½æäº¤"
echo ""
echo "ğŸ“– å¸¸ç”¨å‘½ä»¤ï¼š"
echo "   â€¢ make lint         - è¿è¡Œ Android Lint æ£€æŸ¥"
echo "   â€¢ make ktlint       - è¿è¡Œ Ktlint æ£€æŸ¥"
echo "   â€¢ make format       - è‡ªåŠ¨æ ¼å¼åŒ– Kotlin ä»£ç "
echo "   â€¢ make commit       - æ™ºèƒ½æäº¤ï¼ˆæ ¼å¼åŒ–éœ€è¯¢é—®ï¼Œæ£€æŸ¥é”™è¯¯æ—¶ä¼šè¯¢é—®ï¼‰"
echo "   â€¢ make commit-force - å¼ºåˆ¶æäº¤ï¼ˆå¿½ç•¥ lint é”™è¯¯ï¼‰"
echo "" 